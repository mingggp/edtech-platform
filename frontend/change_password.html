<!doctype html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>เปลี่ยนรหัสผ่าน — EdTech</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="min-h-screen flex items-center justify-center bg-gray-50 p-6">
  <div class="bg-white p-8 rounded-2xl shadow w-full max-w-md space-y-4">
    <h1 class="text-2xl font-bold text-center">เปลี่ยนรหัสผ่าน</h1>
    <form id="form" class="space-y-3">
      <input id="old_password" type="password" placeholder="รหัสผ่านเดิม" class="w-full border rounded-lg p-3" required />
      <input id="new_password" type="password" placeholder="รหัสผ่านใหม่" class="w-full border rounded-lg p-3" required />
      <button class="w-full bg-black text-white rounded-xl p-3">ยืนยันการเปลี่ยน</button>
    </form>
    <pre id="msg" class="text-sm text-center"></pre>
    <div class="flex justify-center">
      <a href="./me.html" class="text-blue-600 underline">กลับไปหน้าโปรไฟล์</a>
    </div>
  </div>

<script>
const API = (window.location.hostname === "127.0.0.1" || window.location.hostname === "localhost")
  ? "http://127.0.0.1:8000"                       // ถ้าเปิดในเครื่อง ใช้ Database ในเครื่อง
  : "https://edtech-api-zigm.onrender.com";       // ถ้าอยู่บนเว็บจริง ให้ใช้ Database ของจริงzigm.onrender.com";
document.getElementById("form").addEventListener("submit", async (e)=>{
  e.preventDefault();
  const token = localStorage.getItem("token");
  const old_password = document.getElementById("old_password").value;
  const new_password = document.getElementById("new_password").value;
  const msg = document.getElementById("msg");
  msg.textContent = "กำลังดำเนินการ...";
  try {
    const res = await fetch(`${API}/auth/change-password`, {
      method: "POST",
      headers: {
        "Content-Type":"application/json",
        "Authorization": `Bearer ${token}`
      },
      body: JSON.stringify({old_password, new_password})
    });
    const data = await res.json();
    if (!res.ok) throw new Error(data.detail || "เปลี่ยนรหัสไม่สำเร็จ");
    msg.textContent = "✅ " + data.message;
    msg.className = "text-green-600 text-center";
  } catch(err) {
    msg.textContent = "❌ " + err.message;
    msg.className = "text-red-600 text-center";
  }
});
</script>
</body>
</html>
