<!doctype html>
<html lang="th">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô ‚Äî MingSmileyFace</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Prompt', sans-serif; background-color: #f8fafc; }
    .glass { background: rgba(255, 255, 255, 0.8); backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.6); }
    .badge-card { transition: all 0.3s; }
    .badge-locked { filter: grayscale(100%); opacity: 0.5; }
    .badge-unlocked { background: linear-gradient(135deg, #fff, #f0f9ff); border-color: #bae6fd; box-shadow: 0 4px 6px -1px rgba(56, 189, 248, 0.1); }
    .badge-unlocked:hover { transform: translateY(-3px); box-shadow: 0 10px 15px -3px rgba(56, 189, 248, 0.2); }
  </style>
</head>
<body class="text-slate-800 pb-20">

  <nav class="sticky top-0 z-50 bg-white/90 backdrop-blur-md border-b border-slate-200 h-16 flex items-center px-6 mb-8">
      <a href="./me.html" class="flex items-center gap-2 text-slate-500 hover:text-indigo-600 transition font-bold">
          <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/></svg>
          ‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤ Dashboard
      </a>
      <h1 class="ml-auto font-bold text-lg text-indigo-600 flex items-center gap-2">üèÜ Achievements Hall</h1>
  </nav>

  <main class="max-w-5xl mx-auto px-4">
      <div class="text-center mb-10">
          <div class="inline-block p-4 rounded-full bg-yellow-100 text-4xl mb-4 shadow-sm">üëë</div>
          <h2 class="text-3xl font-black text-slate-800 mb-2">‡∏´‡∏≠‡πÄ‡∏Å‡∏µ‡∏¢‡∏£‡∏ï‡∏¥‡∏¢‡∏®</h2>
          <p class="text-slate-500">‡∏™‡∏∞‡∏™‡∏°‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç‡∏ï‡∏£‡∏≤‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ‡πÅ‡∏•‡∏∞‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ö‡πâ‡∏≤‡∏Ñ‡∏•‡∏±‡πà‡∏á‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì!</p>
          <div class="mt-4 inline-flex items-center gap-2 px-4 py-1.5 bg-white border border-slate-200 rounded-full text-xs font-bold text-slate-600 shadow-sm">
              <span class="w-2 h-2 rounded-full bg-emerald-500"></span> ‡∏õ‡∏•‡∏î‡∏•‡πá‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß: <span id="unlockCount" class="text-indigo-600">0</span> / <span id="totalCount">0</span>
          </div>
      </div>

      <div id="badgeList" class="space-y-8">
          </div>
  </main>

  <script>
    const API = "https://edtech-api-zigm.onrender.com";
    const token = localStorage.getItem("token");
    if (!token) location.href = "./login.html";

    async function loadAchievements() {
        try {
            const res = await fetch(`${API}/users/me/achievements`, { headers: { Authorization: `Bearer ${token}` } });
            const badges = await res.json();
            
            // Group by category
            const groups = badges.reduce((acc, b) => {
                (acc[b.category] = acc[b.category] || []).push(b);
                return acc;
            }, {});

            document.getElementById("unlockCount").textContent = badges.filter(b => b.is_unlocked).length;
            document.getElementById("totalCount").textContent = badges.length;

            const container = document.getElementById("badgeList");
            container.innerHTML = "";

            const categoryOrder = ["General", "Learning", "Crazy"];
            const categoryTitles = { "General": "‡∏à‡∏∏‡∏î‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô (General)", "Learning": "‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏û‡∏µ‡∏¢‡∏£ (Learning)", "Crazy": "‡∏ö‡πâ‡∏≤‡∏û‡∏•‡∏±‡∏á (Crazy Mode)" };

            categoryOrder.forEach(cat => {
                if(groups[cat]) {
                    const section = document.createElement("div");
                    section.innerHTML = `
                        <h3 class="text-xl font-bold text-slate-700 mb-4 flex items-center gap-2 border-l-4 border-indigo-500 pl-3">
                            ${categoryTitles[cat] || cat}
                        </h3>
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                            ${groups[cat].map(b => `
                                <div class="badge-card p-4 rounded-2xl border ${b.is_unlocked ? 'badge-unlocked border-indigo-100' : 'badge-locked border-slate-200 bg-slate-50'} flex flex-col items-center text-center relative group">
                                    <div class="text-4xl mb-3 transform transition group-hover:scale-110">${b.icon}</div>
                                    <div class="font-bold text-slate-800 text-sm mb-1">${b.name}</div>
                                    <div class="text-xs text-slate-500 leading-relaxed">${b.desc}</div>
                                    ${b.is_unlocked ? '<div class="absolute top-2 right-2 text-emerald-500 bg-emerald-100 rounded-full p-0.5"><svg class="w-3 h-3" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg></div>' : '<div class="absolute top-2 right-2 text-slate-400"><svg class="w-3 h-3" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"/></svg></div>'}
                                </div>
                            `).join("")}
                        </div>
                    `;
                    container.appendChild(section);
                }
            });

        } catch (e) { console.error(e); }
    }
    loadAchievements();
  </script>
</body>
</html>